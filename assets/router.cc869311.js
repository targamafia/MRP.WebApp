import{E as I,u as U,a as K,H as L,T as B,I as _,M as j,b as te,d as J,r as se,i as re,c as ae,e as ne,f as W,g as X,A as ie,h as oe,j as le,k as ce,l as ue,m as de,n as me,o as ge}from"./appRouter.0a35360f.js";import{d as he,a as pe,Q as fe}from"./questionCard.756ece09.js";import{a1 as T,j as e,a as $,b as n,F as q,N as k,O as xe,r as d,Q,R as be,c as b,a2 as ve}from"./index.c96ac677.js";import{R as F,N as ye}from"./404.aa9876a4.js";import{N as H,d as Ne,M as Ce,A as Ee,C as we,u as R,I as A,a as Se}from"./index.esm.42d153a1.js";import{G as Ae}from"./gradedAssessmentsList.909f3432.js";import"./grade.1a7e43a4.js";const Ie=()=>{const{id:t}=T();if(!t)return e(I,{message:"Missing assessment Id"});const s=$(),{assessment:r,error:a,loading:i}=U(t),{mutate:o}=K(()=>s("/assessments"));return e(L,{loading:i,error:a,children:()=>n(q,{children:[n("div",{className:"sticky top-0 pt-12 px-7",children:[e("div",{className:"absolute -z-10 w-full h-full top-0 left-0 opacity-20 bg-cover bg-center",style:{backgroundImage:`url("${r==null?void 0:r.thumbnailUrl}")`}}),e(B,{title:r.title,back:!0,cta:n(q,{children:[e(k,{to:"./edit",className:"hover:text-orange hover:scale-110 transition-all",children:e(he,{})}),e(_,{onClick:()=>{!confirm(`Est\xE1s a punto de borrar ${r==null?void 0:r.title}, \xBFquieres continuar?`)||o(t)},className:"hover:!text-error-50 hover:scale-110 transition-all",children:e(pe,{})})]})})]}),n(j,{children:[n(F,{spacing:4,className:"mb-8",items:"center",children:[e(H,{to:"details",label:"Detalles"}),e(H,{to:"questions",label:"Preguntas"}),e(H,{to:"history",label:"Historial"})]}),e(xe,{})]})]})})},qe=t=>{const[s,r]=d.exports.useState([]),a=()=>{if(!t.assessments)return r([]);const i=[];for(var o=0;o<t.assessments.length;o++){const l=t.assessments[o];for(var c=0;c<l.categories.length;c++){const u=l.categories[c];i.includes(u)||i.push(u)}}r(i)};return d.exports.useMemo(()=>{a()},[t.assessments]),n("div",{className:"max-w-xs rounded-md",children:[e("h2",{className:"mb-2",children:"Filtros"}),n("div",{className:"flex flex-row gap-4 items-center relative my-4",children:[e("h3",{className:"mt-4 hidden","aria-hidden":!0,children:"Buscar"}),e("input",{type:"text",id:"query",placeholder:"Buscar",autoComplete:"off","aria-label":"Buscar",className:"outline outline-neutral-70 w-full mt-2 placeholder:text-neutral-50 pl-10",onChange:i=>t.dispatch({property:"query",value:i.currentTarget.value})}),e(Ne,{className:"absolute left-2 mt-1 top-1/2 -translate-y-1/2"})]}),e("h3",{className:"mt-4",children:"Categor\xEDas"}),e(Ce,{allOptions:s,selectedOptions:t.state.categories,onChange:i=>t.dispatch({property:"categories",value:i})})]})},Me=(t,s)=>{switch(s.property){case"categories":return t.categories.includes(s.value)?{...t,categories:t.categories.filter(r=>r!=s.value)}:{...t,categories:[s.value,...t.categories]};case"query":return{...t,query:s.value};default:return console.error("Unkown action property"),{...t}}},Fe=()=>{const{assessments:t,loading:s,error:r}=te(),[a,i]=d.exports.useReducer(Me,{categories:[],query:""}),o=d.exports.useMemo(()=>{if(!t)return[];const c=a.query!="",l=a.categories.length>0,u=new RegExp(a.query,"ig");return t.filter(m=>(!l||m.categories.some(g=>a.categories.includes(g)))&&(!c||[m.title,m.categories.join(" "),m.description].some(g=>g!==void 0&&u.test(g))))},[t,a.categories,a.query]);return n(j,{sidebar:e(qe,{assessments:t,state:a,dispatch:i}),children:[e(B,{cta:e(k,{to:"new",className:"block bg-blue px-4 py-2 rounded-md text-white hover:bg-primary-40",children:"Crear nuevo Examen"}),title:"Ex\xE1menes"}),e(L,{loading:s,error:r,children:()=>e(Ee,{assessments:o})})]})},D=t=>{const{name:s,register:r,blob:a,setValue:i,label:o}=t;let[c,l]=d.exports.useState(t.defaultValue);return d.exports.useEffect(()=>{var m;if(!(a===void 0||!((m=a[0])!=null&&m.size))){var u=new FileReader;if(a[0].size>2*1e6)return alert(`La imagen es demasiado grande.
      
      Las im\xE1genes no pueden pesar m\xE1s de 8MB`),i("imageBlob",void 0);u.readAsDataURL(a[0]),u.onload=()=>{let g=u.result.toString().replace(/^data:(.*,)?/,"");g.length%4>0&&(g+="=".repeat(4-g.length%4));const y=`data:text/css;base64,${g}`;l(y)}}},[a]),n(q,{children:[!!o&&e("label",{htmlFor:s,children:o}),e("input",{type:"file",...r("imageBlob",{required:t.required}),id:s,accept:"image/*"}),!!c&&n("div",{className:"max-w-xs mx-auto w-full relative mt-4",children:[e("img",{src:c,alt:"",className:"w-full"}),e(_,{className:"!text-red-500 !absolute !top-2 !right-2 !bg-surface-2 !rounded-full !w-8 !h-8",onClick:()=>{confirm("\xBFQuieres borrar la imagen?")&&(i(t.name,"",{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),i("imageBlob",void 0,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),l(""))},children:e(J,{})})]})]})},v=t=>n("div",{className:["p-4 border border-solid rounded-md w-full shadow-lg",t.type=="error"&&"border-error-60 bg-error-50 text-white",t.type=="info"&&"border-blue bg-surface-2"].join(" "),children:[e("h2",{children:t.title!==void 0?t.title:t.type=="info"?"\xC9xito":"Error"}),e("p",{children:t.message})]});var z={},Le=re.exports;Object.defineProperty(z,"__esModule",{value:!0});var G=z.default=void 0,Be=Le(se()),Te=ae,Pe=(0,Be.default)((0,Te.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"AddOutlined");G=z.default=Pe;const Y=t=>{const s=d.exports.useRef(null),[r,a]=d.exports.useState(t.defaultValue||[]),i=t.label||t.name[0].toLocaleUpperCase()+t.name.slice(1),o=()=>{s===null||s.current===null||(a([s.current.value.trim(),...r]),s.current.value="")},c=l=>{a(r.filter(u=>u!==l.value))};return d.exports.useEffect(()=>{t.setValue(t.name+"[]",r)},[r]),n("div",{className:"flex flex-col gap-4 w-full",children:[e("input",{type:"hidden",...t.register(t.name+"[]")}),n("div",{className:"flex flex-row gap-4 w-full items-end",children:[n("div",{className:"flex flex-col gap-1 grow",children:[n("label",{htmlFor:"multiselect",children:[i,":"]}),e("textarea",{onKeyUp:l=>{l.key=="Enter"&&(l.preventDefault(),o())},onSubmit:l=>{l.preventDefault(),o()},rows:1,className:"resize-none",placeholder:i,id:"multiselect",ref:s})]}),e(_,{"aria-label":"add",onClick:o,children:e(G,{color:"primary"})})]}),e(F,{spacing:4,wrap:!0,children:r.map(l=>e(we,{color:"primary",label:l,onDelete:()=>c({value:l})},l))})]})},Ve=()=>{const{register:t,handleSubmit:s,setValue:r,watch:a}=R(),[i,o]=d.exports.useState(),[c,l]=d.exports.useState(!1),u=$(),m=a("imageBlob"),g=p=>{o({type:"error",content:p})},y=p=>{o({type:"info",content:`"${p.title}" se cre\xF3 exitosamente`}),m&&W(m[0],`${p._id||p.id||""}`),l(!0),setTimeout(()=>u("../"),2e3)},{mutate:E,error:w,isLoading:N}=ne(y,g);return n("form",{onSubmit:s(p=>{!confirm(`\xBFCrear ${p.title}?`)||(delete p.imageBlob,E(p))}),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[!!w&&e(v,{type:"error",title:"Error",message:w.toString()}),i!==void 0&&e(v,{type:i.type,message:i.content,title:i.type=="error"?"Error":"\xC9xito"}),!c&&n("div",{className:"flex flex-col gap-4",children:[e(A,{type:"text",register:t,name:"title",label:"Nombre",required:!0}),e(A,{type:"textarea",register:t,name:"description",label:"Descripci\xF3n"}),e(D,{name:"thumbnailUrl",register:t,setValue:r,blob:m,label:"Imagen",defaultValue:""}),e(Y,{register:t,name:"categories",setValue:r,label:"Categor\xEDas"})]}),N?e(Q,{}):!c&&e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},_e=()=>n(j,{children:[n(F,{spacing:2,items:"center",wrap:!1,children:[e(k,{to:"../",className:"mb-8",children:e(X,{})}),e("h1",{className:"mb-8 grow",children:"Nuevo Examen"})]}),e(Ve,{})]}),$e=()=>{const{id:t}=T();if(!t)return e(I,{message:"Missing assessment Id"});const{assessment:s,error:r,loading:a}=U(t);return e(L,{loading:a,error:r,children:()=>n(q,{children:[e(B,{title:"Detalles"}),e("h2",{children:"Categor\xEDas"}),s.categories!==void 0&&e(Se,{elements:s.categories}),e("hr",{className:"my-4"}),e("h2",{className:"mb-2",children:"Descripci\xF3n"}),e("p",{className:"mb-8",children:s.description!==void 0?s.description:"Sin descripci\xF3n"}),e("hr",{className:"my-4"}),e("h2",{className:"mb-4",children:"Vista Previa"}),e("div",{className:"p-8 rounded-md bg-surface-2",children:e(ie,{...s,id:t})})]})})},ke=()=>{const{id:t}=T();if(!t)return e(I,{message:"Missing assessment Id"});const{assessment:s,error:r,loading:a}=U(t);return e(L,{loading:a,error:r,children:()=>{var i;return n("div",{className:"flex flex-col gap-8",children:[e(B,{title:"Preguntas",cta:e(k,{to:"new",className:"bg-blue px-4 py-2 rounded-md text-white",children:"Agregar Pregunta"})}),s!==void 0?!!s.questions&&((i=s.questions)==null?void 0:i.length)>0?s.questions.map((o,c)=>e(fe,{question:o,assessmentId:s._id||s.id},c)):e(v,{type:"info",title:"Oops, no hay preguntas",message:"Agrega una pregunta"}):e(v,{type:"error",title:"Oops, no encontr\xE9 ese examen",message:"Intenta con otro"})]})}})},Oe=()=>{const{id:t}=T();if(!t)return e(I,{message:"Missing assessment Id"});const{gradedAssessments:s,error:r,loading:a}=oe(t);return e(L,{loading:a,error:r,children:()=>n(q,{children:[e(B,{title:"Historial"}),e("h2",{children:"Categor\xEDas"}),e(Ae,{gradedAssessments:s})]})})},Ue=(t,s)=>{const r=t.slice();switch(s.type){case"add":return r.splice(r.length,0,{_id:"",discriminator:"option",value:"",isCorrectAnswer:!1}),r;case"remove":if(s.index===void 0)throw"Missing index";return confirm(`Est\xE1s a punto de quitar la ${s.index+1} opci\xF3n`)?(r.splice(s.index,1),r):t;case"change":if(s.index===void 0)throw"Missing index";if(!s.item)throw"Missing item";return r.map((a,i)=>i!==s.index?{...a}:{...a,...s.item})}},Z=t=>{const[s,r]=d.exports.useReducer(Ue,t.defaultValue||[{discriminator:"option",value:"",isCorrectAnswer:!1},{discriminator:"option",value:"",isCorrectAnswer:!1}]),a=(i,o)=>c=>{r({type:"change",index:i,item:o=="isCorrect"?{isCorrectAnswer:c.currentTarget.checked}:{value:c.currentTarget.value}})};return d.exports.useEffect(()=>{t.setValue(t.name,s)},[s]),e("div",{className:"mt-16",children:n(q,{children:[s.map((i,o)=>n("div",{className:"mb-8",children:[e("hr",{className:"mb-4"}),n(F,{spacing:4,className:"mb-4",children:[n("h4",{className:"grow w-6 text-2xl font-bold",children:["Opci\xF3n ",o+1,":"]}),e(_,{onClick:()=>r({type:"remove",index:o}),children:e(J,{})})]}),n(F,{spacing:4,grow:!0,children:[n("div",{className:"grow",children:[e("label",{htmlFor:`${o}-value`,className:"mb-2 block",children:"Respuesta"}),e("input",{id:`${o}-value`,type:"text",onChange:a(o,"value"),value:i.value,className:"grow w-full",autoComplete:"none"})]}),n("div",{children:[e("label",{htmlFor:`${o}-isCorrect`,className:"block",children:"Es Correcta"}),e("input",{id:`${o}-isCorrect`,type:"checkbox",onChange:a(o,"isCorrect"),defaultChecked:i.isCorrectAnswer})]})]})]},o)),e(_,{onClick:()=>r({type:"add"}),className:"!mx-auto !block",children:e(G,{})})]})})},Qe=()=>{const{register:t,handleSubmit:s,setValue:r,watch:a}=R(),{id:i}=T();if(!i)return e(I,{message:"Missing assessment id"});const[o,c]=d.exports.useState(),l=$(),[u,m]=d.exports.useState("MULTIPLE_CHOICE"),[g,y]=d.exports.useState(!1),E=a("imageBlob"),w=h=>{if(c({type:"info",content:"La pregunta se agreg\xF3 correctamente"}),E){const C=h.questions.pop();ce(E[0],i,C._id)}y(!0),setTimeout(()=>l("../"),2e3)},N=h=>{c({type:"error",content:h})},{mutate:P,error:p,isLoading:S,reset:V}=le({assessmentId:i,onSuccess:w,onError:N}),M=h=>h.options.length>=2&&h.options.some(C=>C.isCorrectAnswer);return n("form",{onSubmit:s(h=>{if(c(void 0),V(),!M(h))return N("La pregunta no es v\xE1lida");delete h.imageBlob,P(h)}),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[e(B,{back:!0,title:"Nueva Pregunta"}),!g&&n("div",{className:"flex flex-col gap-4",children:[e(A,{type:"text",register:t,name:"title",label:"Pregunta",required:!0}),e(D,{name:"imageUrl",register:t,setValue:r,blob:E,label:"Imagen",defaultValue:""}),n("div",{className:"flex flex-col gap-1",children:[e("label",{htmlFor:"type",children:"Tipo:"}),n("select",{...t("type"),onChange:h=>m(h.currentTarget.value),required:!0,children:[e("option",{value:"MULTIPLE_CHOICE",children:"Opci\xF3n M\xFAltiple"}),e("option",{value:"BOOLEAN",children:"S\xED o No"})]}),e("input",{type:"hidden",...t("options"),required:!0}),u==="MULTIPLE_CHOICE"?e(Z,{setValue:r,name:"options"}):e(q,{})]})]}),!!p&&e(v,{type:"error",title:"Error",message:p.toString()}),o!==void 0&&!p&&e(v,{type:o.type,message:o.content.toString(),title:o.type=="error"?"Error":"\xC9xito"}),S?e(Q,{}):!g&&e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})};function Re(t){const{register:s,handleSubmit:r,setValue:a,formState:i,getValues:o,watch:c}=R({defaultValues:{...t.assessment,imageBlob:void 0}}),[l,u]=d.exports.useState(),[m,g]=d.exports.useState(!1),y=$(),E=c("imageBlob"),w=f=>{u({type:"info",content:`Cambios en "${f.title}" se guardaron correctamente`}),g(!0),setTimeout(()=>y("../"),2e3)},N=f=>{u({type:"error",content:f})},{mutate:P,error:p,isLoading:S}=ue(w,N),{mutate:V,error:M,isLoading:O}=K(()=>y("../../")),h=()=>{!confirm(`Est\xE1s a punto de borrar ${t.assessment.title}, esto no se puede deshacer.
        \xBFQuieres continuar?`)||(V(t.assessment._id||t.assessment.id),g(!0),u({type:"info",content:`${t.assessment.title} se borr\xF3 correctamente`}))},C=async f=>{!f.title||!confirm(`\xBFModificar ${f.title}?`)||(f.imageBlob&&(f.thumbnailUrl=await W(f.imageBlob[0],`${t.assessment._id||t.assessment.id||""}`),delete f.imageBlob),P({...t.assessment,...f}))};return n("form",{onSubmit:r(f=>C(f)),className:"text-left flex flex-col items-stretch gap-6 relative",children:[!m&&n("div",{className:"flex flex-col gap-4",children:[e(k,{to:"../",children:e(X,{})}),e(A,{type:"text",register:s,name:"title",label:"Nombre",required:!0}),e(A,{type:"textarea",register:s,name:"description",label:"Descripci\xF3n"}),e(D,{name:"thumbnailUrl",register:s,setValue:a,blob:E,label:"Imagen",defaultValue:t.assessment.thumbnailUrl}),n(F,{className:"gap-16 mx-auto",children:[e(A,{type:"checkbox",register:s,name:"isPrivate",label:"Examen Privado"}),e(A,{type:"checkbox",register:s,name:"isPremium",label:"Examen Premium"})]}),e(Y,{register:s,name:"categories",label:"Categor\xEDas",setValue:a,defaultValue:o().categories})]}),!!p&&e(v,{type:"error",title:"Error",message:p.toString()}),!!M&&e(v,{type:"error",title:"Error",message:M.toString()}),l!==void 0&&e(v,{type:l.type,message:l.content,title:l.type=="error"?"Error":"\xC9xito"}),S||O?e(Q,{}):!m&&n(F,{spacing:4,items:"stretch",justify:"center",children:[e("div",{className:"bg-error-50 rounded-md text-white px-8 py-2 hover:bg-error-60 cursor-pointer",onClick:h,children:"Borrar"}),e("input",{type:"submit",value:"Guardar",disabled:!i.isValid&&!m,className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40"})]})]})}const De=()=>{const{id:t}=T();if(!t)return e(I,{message:"No ID Found in route"});const{assessment:s,error:r,loading:a}=U(t);return e(L,{loading:a,error:r,children:()=>e(Re,{assessment:s})})},He=De,je=t=>{const[s,r]=d.exports.useState(),a=$(),[i,o]=d.exports.useState("MULTIPLE_CHOICE"),[c,l]=d.exports.useState(!1),u=x=>{r({type:"error",content:x})},m=()=>{r({type:"info",content:"La pregunta se actualiz\xF3 correctamente"}),l(!0),setTimeout(()=>a("../"),2e3)},{mutate:g,isLoading:y}=de(t.assessmentId,t.question._id,m,u),E=()=>{var x;if(C!==void 0&&((x=C[0])==null?void 0:x.size)>0)return g(C[0]);m()},{mutate:w,error:N,isLoading:P,reset:p}=me({assessmentId:t.assessmentId,questionId:t.question._id,onSuccess:E,onError:u}),{register:S,handleSubmit:V,setValue:M,watch:O,getValues:h}=R({defaultValues:{...t.question,imageBlob:void 0}}),C=O("imageBlob"),f=x=>x.options.length>=2&&x.options.some(ee=>ee.isCorrectAnswer);return n("form",{onSubmit:V(x=>(r(void 0),p(),f(x)?(delete x.imageBlob,w(x)):u("La pregunta no es v\xE1lida"))),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[e(B,{back:!0,title:"Editar Pregunta"}),!c&&n("div",{className:"flex flex-col gap-4",children:[e(A,{type:"text",register:S,name:"title",label:"Pregunta",required:!0}),e(D,{name:"imageUrl",register:S,setValue:M,blob:C,label:"Imagen",defaultValue:t.question.imageUrl}),n("div",{className:"flex flex-col gap-1",children:[e("label",{htmlFor:"type",children:"Tipo:"}),n("select",{...S("type",{required:!0}),onChange:x=>o(x.currentTarget.value),value:h().type,children:[e("option",{value:"MULTIPLE_CHOICE",children:"Opci\xF3n M\xFAltiple"}),e("option",{value:"BOOLEAN",children:"S\xED o No"})]}),e("input",{type:"hidden",...S("options",{required:!0}),value:h().options&&h().options.toString()||""}),i==="MULTIPLE_CHOICE"?e(Z,{setValue:M,name:"options",defaultValue:h().options}):e(q,{})]})]}),!!N&&e(v,{type:"error",title:"Error",message:N.toString()}),s!==void 0&&!N&&e(v,{type:s.type,message:s.content.toString(),title:s.type=="error"?"Error":"\xC9xito"}),P||y?e(Q,{}):!c&&e("input",{type:"submit",value:"Actualizar",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},ze=()=>{const{id:t,questionId:s}=T();if(!t)return e(I,{message:"Missing assessment id"});if(!s)return e(I,{message:"Missing question id"});const{question:r,error:a,loading:i}=ge({assessmentId:t,questionId:s});return e(L,{loading:i,error:a,children:()=>e(je,{question:r,assessmentId:t})})},Ge=ze,st=()=>n(be,{children:[e(b,{index:!0,element:e(Fe,{})}),e(b,{path:"new",element:e(_e,{})}),n(b,{path:":id",element:e(Ie,{}),children:[e(b,{index:!0,element:e(ve,{to:"details",replace:!0})}),e(b,{path:"details",element:e($e,{})}),n(b,{path:"questions",children:[e(b,{path:"",element:e(ke,{})}),e(b,{path:"new",element:e(Qe,{})}),e(b,{path:":questionId",element:e(Ge,{})})]}),e(b,{path:"history",element:e(Oe,{})}),e(b,{path:"edit",element:e(He,{})})]}),e(b,{path:"*",element:e(ye,{})})]});export{st as default};
