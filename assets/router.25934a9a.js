import{G as S,K as P,M as U,T as E,H as p,h as Q,E as x,L as O,N as A,J as j,O as B,P as H,Q as F,c as T,b as D,A as G}from"./appRouter.fd823983.js";import{r as g,b as i,j as e,a as I,N as R,F as f,O as q,Y as _,a1 as y,Q as $,$ as z,X as J,L as k,R as K,c as u,a2 as X}from"./index.49bb7981.js";import{a as Y,M as V,b as L,u as W,I as N,N as C,A as Z}from"./index.esm.a1c95d8d.js";import{R as v,N as ee}from"./404.ef5aa5c7.js";import{G as se}from"./gradedAssessmentsList.7080bee6.js";import"./grade.5acb53e4.js";const re=s=>{const[r,n]=g.exports.useState([]),a=()=>{if(!s.users)return n([]);const t=[];for(var l=0;l<s.users.length;l++){const m=s.users[l];for(var o=0;o<m.roles.length;o++){const h=m.roles[o];t.includes(h)||t.push(h)}}n(t)};return g.exports.useMemo(()=>{a()},[s.users]),i("div",{className:"rounded-md flex flex-row gap-8",children:[i("div",{className:"flex flex-row gap-4 items-center relative my-4 grow",children:[e("h3",{className:"mt-4 hidden","aria-hidden":!0,children:"Buscar"}),e("input",{type:"text",id:"query",placeholder:"Buscar",autoComplete:"off","aria-label":"Buscar",className:"outline outline-neutral-70 w-full mt-2 placeholder:text-neutral-50 pl-10",onChange:t=>s.dispatch({property:"query",value:t.currentTarget.value})}),e(Y,{className:"absolute left-2 mt-1 top-1/2 -translate-y-1/2"})]}),i("div",{className:"flex flex-col grow",children:[e("h3",{className:"mt-4",children:"Rol"}),e(V,{allOptions:r,selectedOptions:s.state.roles,onChange:t=>s.dispatch({property:"roles",value:t})})]})]})},ae=s=>{const r=I();return i("tr",{className:"bg-surface-4 text-main rounded-lg cursor-pointer hover:bg-surface-5 hover:border-surface-1 hover:shadow-sm overflow-hidden",onClick:()=>r(s.user._id||""),children:[e("td",{className:"px-4 py-2",children:i("h3",{children:[s.user.name," ",s.user.lastName]})}),e("td",{className:"px-4 py-2",children:e("p",{children:s.user.email})}),e("td",{className:"px-4 py-2",children:e("p",{children:s.user.companyCode})}),e("td",{className:"px-4 py-2 image.pngpointer-events-none",children:e(L,{elements:s.user.roles,noMargin:!0})}),e("td",{className:"",children:e(R,{to:s.user._id||"",children:e(S,{color:"info"})})})]})},ne=s=>i("div",{className:"flex flex-col gap-4",children:[e("div",{className:"px-4 grid grid-cols-[minmax(max-content,_1fr)_minmax(max-content,_1fr)_minmax(max-content,_1fr)_minmax(min-content,_1fr)_1rem] gap-4 items-center pr-4"}),i("table",{className:"items-center border-spacing-y-2 border-separate",children:[e("thead",{children:i("tr",{className:"text-left",children:[e("th",{className:"px-4 py-2",children:"Nombre"}),e("th",{className:"px-4 py-2",children:"Correo"}),e("th",{className:"px-4 py-2",children:"Compa\xF1ia"}),e("th",{className:"px-4 py-2",children:"Roles"}),e("th",{})]})}),e("tbody",{children:s.users.length!==0?s.users.map((r,n)=>e(ae,{user:r},r._id)):e("tr",{children:e("td",{children:e("p",{children:"No se encontraron usuarios"})})})})]})]}),te=(s,r)=>{switch(r.property){case"roles":return s.roles.includes(r.value)?{...s,roles:s.roles.filter(n=>n!=r.value)}:{...s,roles:[r.value,...s.roles]};case"query":return{...s,query:r.value};default:return console.error("Unkown action property"),{...s}}},ie=()=>{const{users:s,loading:r,error:n}=P(),[a,t]=g.exports.useReducer(te,{roles:[],query:""}),l=g.exports.useMemo(()=>{if(!s)return[];const o=a.query!="",m=a.roles.length>0,h=new RegExp(a.query,"ig");return s.filter(d=>(!m||d.roles.some(c=>a.roles.includes(c)))&&(!o||[[d.name,d.lastName].join(" "),d.email,d.roles.join(" "),d.companyCode].some(c=>c!==void 0&&h.test(c))))},[s,a.roles,a.query]);return i(f,{children:[i(U,{children:[i("div",{className:"px-8 py-4 bg-surface-5 mb-12 rounded-lg shadow-inner",children:[e(E,{title:"Usuarios"}),e("div",{className:"-mt-8"}),e(re,{users:s,state:a,dispatch:t})]}),e(p,{loading:r,error:n,children:()=>e(ne,{users:l})})]}),e(q,{})]})},le=()=>{const{register:s,handleSubmit:r}=W();return i("form",{onSubmit:r(()=>{}),className:"flex flex-col gap-4",children:[e(N,{type:"text",name:"name",register:s,required:!0}),e(N,{type:"text",name:"lastName",register:s,required:!0,label:"Last Name"}),e(N,{type:"email",name:"email",register:s,required:!0}),e(N,{type:"text",name:"companyCode",register:s,label:"Company Code"}),e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},oe=()=>i(U,{children:[i(v,{spacing:2,items:"center",wrap:!1,children:[e(R,{to:"../",className:"mb-8",children:e(Q,{})}),e("h1",{className:"mb-8 grow",children:"Nuevo Usuario"})]}),e(le,{})]}),ce=async s=>await _("/v1/users/password-recovery-pin",{email:s});function de(){const{id:s}=y();if(!s)return e(x,{message:"Missing assessment id"});const{stats:r,loading:n,error:a}=O(s);return e(p,{loading:n,error:a,children:()=>i("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-center",children:[e(A,{to:"history",data:r.takenAssessments,label:"Ex\xE1menes finalizados",loading:n,error:a}),e(A,{to:"assigned",data:r.premiumAssessments,label:"Ex\xE1menes asignados",loading:n,error:a})]})})}const me=()=>{const s=I(),{id:r}=y(),[n,a]=g.exports.useState(!1);if(!r)return e(x,{message:"Missing assessment id"});const{user:t,loading:l,error:o}=j(r),m=()=>{ce(t.email),a(!0)};return e(p,{loading:l,error:o,children:()=>i(f,{children:[e("div",{className:"fixed left-0 top-0 w-screen h-screen overflow-hidden bg-surface-1 bg-opacity-20 backdrop-blur-sm",onClick:()=>s("../")}),i("div",{className:"max-w-lg fixed right-0 top-0 h-screen bg-surface-5 pb-16 z-10 overflow-y-auto animate-slide-left px-8",children:[e("div",{className:"sticky top-0 bg-surface-5 pt-16 px-4 -mx-4 bg-opacity-50 backdrop-blur-sm z-10",children:e(E,{title:t.name+" "+t.lastName,back:!0})}),i("div",{className:"flex flex-col gap-6 mb-10",children:[i("div",{className:"flex flex-col gap-1 grow",children:[e("h2",{children:"Email"}),e("p",{children:t.email})]}),i(v,{spacing:4,children:[i("div",{className:"flex flex-col gap-1 grow",children:[e("h2",{children:"Company Code"}),e("p",{children:t.companyCode||"Sin c\xF3digo"})]}),i("div",{className:"flex flex-col gap-1 grow",children:[e("h2",{children:"Rol"}),e(L,{elements:t.roles})]})]})]}),e("div",{className:"flex flex-row gap-8 my-8",children:n?e("div",{className:"px-8 py-2 bg-emerald-500 rounded-md text-white mx-auto",children:"Email enviado"}):e("div",{className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto",onClick:()=>confirm(`\xBFQuiere reiniciar la contrase\xF1a de ${t.name} ${t.lastName}?
                  
                  Esto mandar\xE1 un c\xF3digo al correo ${t.email} para reiniciarla dentro de la app`)&&m,children:"Reiniciar Contrase\xF1a"})}),e("h2",{children:"M\xE9tricas"}),e(de,{}),i(v,{spacing:4,className:"my-8 mx-auto",justify:"center",grow:!0,items:"center",children:[e(C,{to:"history",label:"Historial"}),e(C,{to:"assigned",label:"Asignados"})]}),e("div",{className:"isolate",children:e(q,{})})]})]})})},ue=s=>{var t;if(!s.userId)return e(x,{message:"Invalid user id"});let{gradedAssessments:r,error:n,loading:a}=B(s.userId);return a?e($,{}):n?((t=n.response)==null?void 0:t.status)!=404?e(x,{message:n==null?void 0:n.toString()}):e("p",{children:"No ha contestado ning\xFAn examen"}):r.length>0?e(se,{gradedAssessments:r.sort((l,o)=>new Date(o.endDate).valueOf()-new Date(l.endDate).valueOf())}):e("p",{children:"Este usuario no ha contestado ning\xFAn examen"})},he=()=>{const{id:s}=y();if(!s)throw Error("No se encontr\xF3 el id");return i(f,{children:[e("h2",{children:"Historial"}),e(ue,{userId:s})]})},b="/v1/assessments",ge=(s,r)=>_(`${b}/${s}/assign-user/${r}`),pe=(s,r)=>z(`${b}/${s}/premium-access/${r}`),xe=s=>J(`${b}/premium-access/${s}`),fe=(s,r)=>{const n=k();return F(a=>ge(a,s),{onSuccess:a=>{n.invalidateQueries(["users",a.userId,"premiumAssessments"]),n.invalidateQueries(["users",a.userId,"stats"]),r&&r()}})},Ne=(s,r)=>{const n=k();return F(a=>pe(a,s),{onSuccess:a=>{console.log("aaaaa"),console.log(a.userId),n.invalidateQueries(["users",a.userId,"premiumAssessments"]),n.invalidateQueries(["users",a.userId,"stats"]),r&&r()}})},M=s=>{const{data:r,error:n,isLoading:a}=H(["users",s,"premiumAssessments"],()=>xe(s));return{premiumAssessments:r,error:n,loading:a}},ye=s=>{const{mutate:r,error:n,isLoading:a}=Ne(s.userId,()=>alert("cancelado")),t=()=>{confirm(`Est\xE1s a punto de desasignar este examen
    \xBFQuieres continuar?`)&&r(s.assessmentId)};return e(p,{error:n,loading:a,children:()=>e("div",{className:"rounded-full w-8 h-8 bg-red-600 text-white cursor-pointer scale-100 hover:scale-110 transition-transform duration-150 absolute right-2 top-2 flex justify-center items-center",onClick:t,children:e(T,{})})})},ve=s=>{if(!s.userId)throw Error("No se encontr\xF3 el id");const{premiumAssessments:r,error:n,loading:a}=M(s.userId);return e(p,{loading:a,error:n,children:()=>e("div",{className:"flex flex-col gap-8",children:r!==void 0&&r.map(t=>i("div",{className:"relative",children:[e(Z,{assessment:t}),e(ye,{userId:s.userId,assessmentId:t.id})]},t.id))})})},be=s=>{const[r,n]=g.exports.useState(!1),{mutate:a,error:t,isLoading:l}=fe(s.userId),{assessments:o,error:m,loading:h}=D(),d=o&&o.filter(c=>{var w;return c.isPremium&&!((w=s.assignedAssessments)!=null&&w.includes(c.id))});return r?e(p,{error:t||m,loading:l||h,children:()=>i("div",{className:"flex flex-col gap-4 mb-8",children:[e("p",{className:"text-lg",children:"Haz click en un examen para asign\xE1rselo al usuario"}),d.length>0?d.map(c=>e("div",{className:"cursor-pointer",onClick:()=>a(c.id),children:e("div",{className:"pointer-events-none",children:i(f,{children:[console.log(c),e(G,{assessment:c})]})})},c.id)):e("p",{children:"No hay ex\xE1menes que asignar"})]})}):e("div",{className:"bg-blue text-white px-4 py-2 cursor-pointer rounded-md justify-self-center text-center my-6",onClick:()=>n(!0),children:"Asignar un Examen"})},we=()=>{var t;const{id:s}=y();if(!s)throw Error("No se encontr\xF3 el id");const{premiumAssessments:r,error:n,loading:a}=M(s);return a?e($,{}):i(f,{children:[e("h2",{className:"mt-12 mb-4",children:"Ex\xE1menes Premium"}),e(be,{userId:s,assignedAssessments:r==null?void 0:r.map(l=>l.id)}),e("hr",{className:"my-6 border-t-orange border-t-2"}),e("h3",{className:"mb-4",children:"Asignados"}),n?((t=n.response)==null?void 0:t.status)===404?e("p",{children:"No se encontraron ex\xE1menes"}):e(x,{message:n.toString()}):e(ve,{userId:s})]})},Ae=we,qe=()=>i(K,{children:[e(u,{path:"",element:e(ie,{}),children:i(u,{path:":id",element:e(me,{}),children:[e(u,{index:!0,element:e(X,{to:"history",replace:!0})}),e(u,{path:"history",element:e(he,{})}),e(u,{path:"assigned",element:e(Ae,{})})]})}),e(u,{path:"new",element:e(oe,{})}),e(u,{path:"*",element:e(ee,{})})]});export{qe as default};
