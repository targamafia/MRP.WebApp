import{G as k,K as M,M as C,T as E,H as f,h as S,E as g,L as I,N as w,J as L,O,P,b as j,A as D,Q as H}from"./appRouter.2be088dc.js";import{r as p,b as a,j as e,a as U,N as F,F as N,O as _,Y as $,a1 as y,Q as R,R as G,c as u,a2 as T}from"./index.cb6f32fb.js";import{a as z,M as B,b as q,u as Q,I as x,N as A,A as J}from"./index.esm.ae871b45.js";import{R as v,N as K}from"./404.9dbacbb2.js";import{G as Y}from"./gradedAssessmentsList.61fce6fa.js";import"./grade.3279b26e.js";const V=s=>{const[r,n]=p.exports.useState([]),i=()=>{if(!s.users)return n([]);const t=[];for(var l=0;l<s.users.length;l++){const d=s.users[l];for(var c=0;c<d.roles.length;c++){const h=d.roles[c];t.includes(h)||t.push(h)}}n(t)};return p.exports.useMemo(()=>{i()},[s.users]),a("div",{className:"rounded-md flex flex-row gap-8",children:[a("div",{className:"flex flex-row gap-4 items-center relative my-4 grow",children:[e("h3",{className:"mt-4 hidden","aria-hidden":!0,children:"Buscar"}),e("input",{type:"text",id:"query",placeholder:"Buscar",autoComplete:"off","aria-label":"Buscar",className:"outline outline-neutral-70 w-full mt-2 placeholder:text-neutral-50 pl-10",onChange:t=>s.dispatch({property:"query",value:t.currentTarget.value})}),e(z,{className:"absolute left-2 mt-1 top-1/2 -translate-y-1/2"})]}),a("div",{className:"flex flex-col grow",children:[e("h3",{className:"mt-4",children:"Rol"}),e(B,{allOptions:r,selectedOptions:s.state.roles,onChange:t=>s.dispatch({property:"roles",value:t})})]})]})},W=s=>{const r=U();return a("tr",{className:"bg-surface-4 text-main rounded-lg cursor-pointer hover:bg-surface-5 hover:border-surface-1 hover:shadow-sm overflow-hidden",onClick:()=>r(s.user._id||s.user.id||""),children:[e("td",{className:"px-4 py-2",children:a("h3",{children:[s.user.name," ",s.user.lastName]})}),e("td",{className:"px-4 py-2",children:e("p",{children:s.user.email})}),e("td",{className:"px-4 py-2",children:e("p",{children:s.user.companyCode})}),e("td",{className:"px-4 py-2 image.pngpointer-events-none",children:e(q,{elements:s.user.roles,noMargin:!0})}),e("td",{className:"",children:e(F,{to:s.user.id||"",children:e(k,{color:"info"})})})]})},X=s=>a("div",{className:"flex flex-col gap-4",children:[e("div",{className:"px-4 grid grid-cols-[minmax(max-content,_1fr)_minmax(max-content,_1fr)_minmax(max-content,_1fr)_minmax(min-content,_1fr)_1rem] gap-4 items-center pr-4"}),a("table",{className:"items-center border-spacing-y-2 border-separate",children:[e("thead",{children:a("tr",{className:"text-left",children:[e("th",{className:"px-4 py-2",children:"Nombre"}),e("th",{className:"px-4 py-2",children:"Correo"}),e("th",{className:"px-4 py-2",children:"Compa\xF1ia"}),e("th",{className:"px-4 py-2",children:"Roles"}),e("th",{})]})}),e("tbody",{children:s.users.length!==0?s.users.map(r=>e(W,{user:r},r._id||r.id)):e("tr",{children:e("td",{children:e("p",{children:"No se encontraron usuarios"})})})})]})]}),Z=(s,r)=>{switch(r.property){case"roles":return s.roles.includes(r.value)?{...s,roles:s.roles.filter(n=>n!=r.value)}:{...s,roles:[r.value,...s.roles]};case"query":return{...s,query:r.value};default:return console.error("Unkown action property"),{...s}}},ee=()=>{const{users:s,loading:r,error:n}=M(),[i,t]=p.exports.useReducer(Z,{roles:[],query:""}),l=p.exports.useMemo(()=>{if(!s)return[];const c=i.query!="",d=i.roles.length>0,h=new RegExp(i.query,"ig");return s.filter(m=>(!d||m.roles.some(o=>i.roles.includes(o)))&&(!c||[[m.name,m.lastName].join(" "),m.roles.join(" "),m.companyCode].some(o=>o!==void 0&&h.test(o))))},[s,i.roles,i.query]);return a(N,{children:[a(C,{children:[a("div",{className:"px-8 py-4 bg-surface-5 mb-12 rounded-lg shadow-inner",children:[e(E,{title:"Usuarios"}),e("div",{className:"-mt-8"}),e(V,{users:s,state:i,dispatch:t})]}),e(f,{loading:r,error:n,children:()=>e(X,{users:l})})]}),e(_,{})]})},se=()=>{const{register:s,handleSubmit:r}=Q();return a("form",{onSubmit:r(()=>{}),className:"flex flex-col gap-4",children:[e(x,{type:"text",name:"name",register:s,required:!0}),e(x,{type:"text",name:"lastName",register:s,required:!0,label:"Last Name"}),e(x,{type:"email",name:"email",register:s,required:!0}),e(x,{type:"text",name:"companyCode",register:s,label:"Company Code"}),e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},re=()=>a(C,{children:[a(v,{spacing:2,items:"center",wrap:!1,children:[e(F,{to:"../",className:"mb-8",children:e(S,{})}),e("h1",{className:"mb-8 grow",children:"Nuevo Usuario"})]}),e(se,{})]}),ae=async s=>await $("/v1/users/password-recovery-pin",{email:s});function te(){const{id:s}=y();if(!s)return e(g,{message:"Missing assessment id"});const{stats:r,loading:n,error:i}=I(s);return e(f,{loading:n,error:i,children:()=>a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-center",children:[e(w,{to:"history",data:r.takenAssessments,label:"Ex\xE1menes finalizados",loading:n,error:i}),e(w,{to:"assigned",data:r.premiumAssessments,label:"Ex\xE1menes asignados",loading:n,error:i})]})})}const ne=()=>{const s=U(),{id:r}=y(),[n,i]=p.exports.useState(!1);if(!r)return e(g,{message:"Missing assessment id"});const{user:t,loading:l,error:c}=L(r),d=()=>{ae(t.email),i(!0)};return e(f,{loading:l,error:c,children:()=>a(N,{children:[e("div",{className:"fixed left-0 top-0 w-screen h-screen overflow-hidden bg-surface-1 bg-opacity-20 backdrop-blur-sm",onClick:()=>s("../")}),a("div",{className:"max-w-lg fixed right-0 top-0 h-screen bg-surface-5 pb-16 z-10 overflow-y-auto animate-slide-left px-8",children:[e("div",{className:"sticky top-0 bg-surface-5 pt-16 px-4 -mx-4 bg-opacity-50 backdrop-blur-sm z-10",children:e(E,{title:t.name+" "+t.lastName,back:!0})}),a("div",{className:"flex flex-col gap-6 mb-10",children:[a("div",{className:"flex flex-col gap-1 grow",children:[e("h2",{children:"Email"}),e("p",{children:t.email})]}),a(v,{spacing:4,children:[a("div",{className:"flex flex-col gap-1 grow",children:[e("h2",{children:"Company Code"}),e("p",{children:t.companyCode||"Sin c\xF3digo"})]}),a("div",{className:"flex flex-col gap-1 grow",children:[e("h2",{children:"Rol"}),e(q,{elements:t.roles})]})]})]}),e("div",{className:"flex flex-row gap-8 my-8",children:n?e("div",{className:"px-8 py-2 bg-emerald-500 rounded-md text-white mx-auto",children:"Email enviado"}):e("div",{className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto",onClick:()=>confirm(`\xBFQuiere reiniciar la contrase\xF1a de ${t.name} ${t.lastName}?
                  
                  Esto mandar\xE1 un c\xF3digo al correo ${t.email} para reiniciarla dentro de la app`)&&d,children:"Reiniciar Contrase\xF1a"})}),e("h2",{children:"M\xE9tricas"}),e(te,{}),a(v,{spacing:4,className:"my-8 mx-auto",justify:"center",grow:!0,items:"center",children:[e(A,{to:"history",label:"Historial"}),e(A,{to:"assigned",label:"Asignados"})]}),e("div",{className:"isolate",children:e(_,{})})]})]})})},ie=s=>{var t;if(!s.userId)return e(g,{message:"Invalid user id"});let{gradedAssessments:r,error:n,loading:i}=O(s.userId);return i?e(R,{}):n?((t=n.response)==null?void 0:t.status)!=404?e(g,{message:n==null?void 0:n.toString()}):e("p",{children:"No ha contestado ning\xFAn examen"}):r.length>0?e(Y,{gradedAssessments:r.sort((l,c)=>new Date(c.endDate).valueOf()-new Date(l.endDate).valueOf())}):e("p",{children:"Este usuario no ha contestado ning\xFAn examen"})},le=()=>{const{id:s}=y();if(!s)throw Error("No se encontr\xF3 el id");return a(N,{children:[e("h2",{children:"Historial"}),e(ie,{userId:s})]})},oe=s=>{const[r,n]=p.exports.useState(!1),{mutate:i,error:t,isLoading:l}=P(s.userId),{assessments:c,error:d,loading:h}=j(),m=c&&c.filter(o=>{var b;return o.isPremium&&!((b=s.assignedAssessments)!=null&&b.includes(o._id||o.id))});return r?e(f,{error:t||d,loading:l||h,children:()=>a("div",{className:"flex flex-col gap-4 mb-8",children:[e("p",{className:"text-lg",children:"Haz click en un examen para asign\xE1rselo al usuario"}),m.length>0?m.map(o=>e("div",{className:"cursor-pointer",onClick:()=>i(o._id||o.id),children:e("div",{className:"pointer-events-none",children:e(D,{...o})})},o._id||o.id)):e("p",{children:"No hay ex\xE1menes que asignar"})]})}):e("div",{className:"bg-blue text-white px-4 py-2 cursor-pointer rounded-md justify-self-center text-center my-6",onClick:()=>n(!0),children:"Asignar un Examen"})},ce=()=>{var t;const{id:s}=y();if(!s)throw Error("No se encontr\xF3 el id");const{premiumAssessments:r,error:n,loading:i}=H(s);return i?e(R,{}):a(N,{children:[e("h2",{className:"mt-12 mb-4",children:"Ex\xE1menes Premium"}),e(oe,{userId:s,assignedAssessments:r==null?void 0:r.map(l=>l._id||l.id)}),e("hr",{className:"my-6 border-t-orange border-t-2"}),e("h3",{className:"mb-4",children:"Asignados"}),n?((t=n.response)==null?void 0:t.status)===404?e("p",{children:"No se encontraron ex\xE1menes"}):e(g,{message:n.toString()}):e(J,{assessments:r})]})},de=ce,fe=()=>a(G,{children:[e(u,{path:"",element:e(ee,{}),children:a(u,{path:":id",element:e(ne,{}),children:[e(u,{index:!0,element:e(T,{to:"history",replace:!0})}),e(u,{path:"history",element:e(le,{})}),e(u,{path:"assigned",element:e(de,{})})]})}),e(u,{path:"new",element:e(re,{})}),e(u,{path:"*",element:e(K,{})})]});export{fe as default};
