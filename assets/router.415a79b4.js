import{E as A,u as U,a as W,H as F,d as te,T as B,I as k,M as z,b as se,c as K,r as re,i as ae,e as ie,f as ne,g as J,h as X,A as oe,j as le,k as ce,l as ue,m as de,n as me,o as ge,p as pe}from"./appRouter.fd823983.js";import{d as he,a as fe,Q as be}from"./questionCard.2d62d9a4.js";import{a1 as P,j as e,a as _,b as i,F as q,N as T,O as xe,r as d,Q as O,R as ve,c as b,a2 as ye}from"./index.49bb7981.js";import{R as M,N as Ne}from"./404.ef5aa5c7.js";import{d as Ce,N as H,A as we,a as Ee,M as Se,C as Ae,u as Q,I as S,b as Ie}from"./index.esm.a1c95d8d.js";import{G as qe}from"./gradedAssessmentsList.7080bee6.js";import"./grade.5acb53e4.js";const Me=()=>{const{id:t}=P();if(!t)return e(A,{message:"Missing assessment Id"});const s=_(),{assessment:r,error:a,loading:n}=U(t),{mutate:o}=W(()=>s("/assessments"));return e(F,{loading:n,error:a,children:()=>i(q,{children:[i("div",{className:"sticky top-0 pt-12 px-7",children:[i("div",{className:"flex flex-row gap-4",children:[r.isPrivate&&i("div",{className:"mb-2",children:[e(te,{className:"mb-1"})," Privado"]}),r.isPremium&&i("div",{className:"text-amber-400 mb-2",children:[e(Ce,{className:"mb-1"})," Premium"]})]}),e("div",{className:"absolute -z-10 w-full h-full top-0 left-0 opacity-20 bg-cover bg-center",style:{backgroundImage:`url("${(r==null?void 0:r.thumbnailUrl)||"/MRP.WebApp/placeholder.png"}")`}}),e(B,{title:r.title,back:!0,cta:i(q,{children:[e(T,{to:"./edit",className:"hover:text-orange hover:scale-110 transition-all",children:e(he,{})}),e(k,{onClick:()=>{!confirm(`Est\xE1s a punto de borrar ${r==null?void 0:r.title}, \xBFquieres continuar?`)||o(t)},className:"hover:!text-error-50 hover:scale-110 transition-all",children:e(fe,{})})]})})]}),i(z,{children:[i(M,{spacing:4,className:"mb-8",items:"center",children:[e(H,{to:"details",label:"Detalles"}),e(H,{to:"questions",label:"Preguntas"}),e(H,{to:"history",label:"Historial"})]}),e(xe,{})]})]})})},Fe=t=>e("div",{className:"flex flex-col gap-8",children:t.assessments!==void 0&&t.assessments.map(s=>e(we,{assessment:s},s.id))}),Be=t=>{const[s,r]=d.exports.useState([]),a=()=>{if(!t.assessments)return r([]);const n=[];for(var o=0;o<t.assessments.length;o++){const l=t.assessments[o];for(var c=0;c<l.categories.length;c++){const u=l.categories[c];n.includes(u)||n.push(u)}}r(n)};return d.exports.useMemo(()=>{a()},[t.assessments]),i("div",{className:"max-w-xs rounded-md",children:[e("h2",{className:"mb-2",children:"Filtros"}),i("div",{className:"flex flex-row gap-4 items-center relative my-4",children:[e("h3",{className:"mt-4 hidden","aria-hidden":!0,children:"Buscar"}),e("input",{type:"text",id:"query",placeholder:"Buscar",autoComplete:"off","aria-label":"Buscar",className:"outline outline-neutral-70 w-full mt-2 placeholder:text-neutral-50 pl-10",onChange:n=>t.dispatch({property:"query",value:n.currentTarget.value})}),e(Ee,{className:"absolute left-2 mt-1 top-1/2 -translate-y-1/2"})]}),e("h3",{className:"mt-4",children:"Categor\xEDas"}),e(Se,{allOptions:s,selectedOptions:t.state.categories,onChange:n=>t.dispatch({property:"categories",value:n})})]})},Pe=(t,s)=>{switch(s.property){case"categories":return t.categories.includes(s.value)?{...t,categories:t.categories.filter(r=>r!=s.value)}:{...t,categories:[s.value,...t.categories]};case"query":return{...t,query:s.value};default:return console.error("Unkown action property"),{...t}}},Le=()=>{const{assessments:t,loading:s,error:r}=se(),[a,n]=d.exports.useReducer(Pe,{categories:[],query:""}),o=d.exports.useMemo(()=>{if(!t)return[];const c=a.query!="",l=a.categories.length>0,u=new RegExp(a.query,"ig");return t.filter(m=>(!l||m.categories.some(g=>a.categories.includes(g)))&&(!c||[m.title,m.categories.join(" "),m.description].some(g=>g!==void 0&&u.test(g))))},[t,a.categories,a.query]);return i(z,{sidebar:e(Be,{assessments:t,state:a,dispatch:n}),children:[e(B,{cta:e(T,{to:"new",className:"block bg-blue px-4 py-2 rounded-md text-white hover:bg-primary-40",children:"Crear nuevo Examen"}),title:"Ex\xE1menes"}),e(F,{loading:s,error:r,children:()=>e(Fe,{assessments:o})})]})},j=t=>{const{name:s,register:r,blob:a,setValue:n,label:o}=t;let[c,l]=d.exports.useState(t.defaultValue);return d.exports.useEffect(()=>{var m;if(!(a===void 0||!((m=a[0])!=null&&m.size))){var u=new FileReader;if(a[0].size>2*1e6)return alert(`La imagen es demasiado grande.
      
      Las im\xE1genes no pueden pesar m\xE1s de 8MB`),n("imageBlob",void 0);u.readAsDataURL(a[0]),u.onload=()=>{let g=u.result.toString().replace(/^data:(.*,)?/,"");g.length%4>0&&(g+="=".repeat(4-g.length%4));const N=`data:text/css;base64,${g}`;l(N)}}},[a]),i(q,{children:[!!o&&e("label",{htmlFor:s,children:o}),e("input",{type:"file",...r("imageBlob",{required:t.required}),id:s,accept:"image/*"}),!!c&&i("div",{className:"max-w-xs mx-auto w-full relative mt-4",children:[e("img",{src:c,alt:"",className:"w-full"}),e(k,{className:"!bg-red-500 !absolute !top-2 !right-2 !text-white !rounded-full !w-8 !h-8",onClick:()=>{confirm("\xBFQuieres borrar la imagen?")&&(n(t.name,"",{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),n("imageBlob",void 0,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),l(""))},children:e(K,{})})]})]})},y=t=>i("div",{className:["p-4 border border-solid rounded-md w-full shadow-lg",t.type=="error"&&"border-error-60 bg-error-50 text-white",t.type=="info"&&"border-blue bg-surface-2"].join(" "),children:[e("h2",{children:t.title!==void 0?t.title:t.type=="info"?"\xC9xito":"Error"}),e("p",{children:t.message})]});var D={},$e=ae.exports;Object.defineProperty(D,"__esModule",{value:!0});var G=D.default=void 0,Ve=$e(re()),ke=ie,_e=(0,Ve.default)((0,ke.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"AddOutlined");G=D.default=_e;const Y=t=>{const s=d.exports.useRef(null),[r,a]=d.exports.useState(t.defaultValue||[]),n=t.label||t.name[0].toLocaleUpperCase()+t.name.slice(1),o=()=>{if(s===null||s.current===null)return;const l=s.current.value.trim();a([...r,l[0].toUpperCase()+l.slice(1).toLowerCase()]),s.current.value=""},c=l=>{a(r.filter(u=>u!==l.value))};return d.exports.useEffect(()=>{t.setValue(t.name+"[]",r)},[r]),i("div",{className:"flex flex-col gap-4 w-full",children:[e("input",{type:"hidden",...t.register(t.name+"[]")}),i("div",{className:"flex flex-row gap-4 w-full items-end",children:[i("div",{className:"flex flex-col gap-1 grow",children:[i("label",{htmlFor:"multiselect",children:[n,":"]}),e("textarea",{onKeyUp:l=>{l.key=="Enter"&&(l.preventDefault(),o())},onSubmit:l=>{l.preventDefault(),o()},rows:1,className:"resize-none",placeholder:n,id:"multiselect",ref:s})]}),e(k,{"aria-label":"add",onClick:o,children:e(G,{color:"primary"})})]}),e(M,{spacing:4,wrap:!0,children:r.map(l=>e(Ae,{color:"primary",label:l,onDelete:()=>c({value:l})},l))})]})},Te=()=>{const{register:t,handleSubmit:s,setValue:r,watch:a}=Q(),[n,o]=d.exports.useState(),[c,l]=d.exports.useState(!1),u=_(),m=a("imageBlob"),g=p=>{o({type:"error",content:p})},N=p=>{o({type:"info",content:`"${p.title}" se cre\xF3 exitosamente`}),m&&J(m[0],`${p.id||""}`),l(!0),setTimeout(()=>u("/assessments/"+p.id),2e3)},{mutate:C,error:w,isLoading:x}=ne(N,g);return i("form",{onSubmit:s(p=>{!confirm(`\xBFCrear ${p.title}?`)||(delete p.imageBlob,C(p))}),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[!!w&&e(y,{type:"error",title:"Error",message:w.toString()}),n!==void 0&&e(y,{type:n.type,message:n.content,title:n.type=="error"?"Error":"\xC9xito"}),!c&&i("div",{className:"flex flex-col gap-4",children:[e(S,{type:"text",register:t,name:"title",label:"Nombre",required:!0}),e(S,{type:"textarea",register:t,name:"description",label:"Descripci\xF3n"}),e(j,{name:"thumbnailUrl",register:t,setValue:r,blob:m,label:"Imagen",defaultValue:""}),e(Y,{register:t,name:"categories",setValue:r,label:"Categor\xEDas"})]}),x?e(O,{}):!c&&e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},Re=()=>i(z,{children:[i(M,{spacing:2,items:"center",wrap:!1,children:[e(T,{to:"../",className:"mb-8",children:e(X,{})}),e("h1",{className:"mb-8 grow",children:"Nuevo Examen"})]}),e(Te,{})]}),Ue=()=>{const{id:t}=P();if(!t)return e(A,{message:"Missing assessment Id"});const{assessment:s,error:r,loading:a}=U(t);return e(F,{loading:a,error:r,children:()=>i(q,{children:[e(B,{title:"Detalles"}),e("h2",{children:"Categor\xEDas"}),s.categories!==void 0&&e(Ie,{elements:s.categories}),e("hr",{className:"my-4"}),e("h2",{className:"mb-2",children:"Descripci\xF3n"}),e("p",{className:"mb-8",children:s.description!==void 0?s.description:"Sin descripci\xF3n"}),e("hr",{className:"my-4"}),e("h2",{className:"mb-4",children:"Vista Previa"}),e("div",{className:"p-8 rounded-md bg-surface-2",children:e(oe,{assessment:s})})]})})},Oe=()=>{const{id:t}=P();if(!t)return e(A,{message:"Missing assessment Id"});const{assessment:s,error:r,loading:a}=U(t);return e(F,{loading:a,error:r,children:()=>{var n;return i("div",{className:"flex flex-col gap-8",children:[e(B,{title:"Preguntas",cta:e(T,{to:"new",className:"bg-blue px-4 py-2 rounded-md text-white",children:"Agregar Pregunta"})}),s!==void 0?!!s.questions&&((n=s.questions)==null?void 0:n.length)>0?s.questions.map((o,c)=>e(be,{question:o,assessmentId:s.id},c)):e(y,{type:"info",title:"Oops, no hay preguntas",message:"Agrega una pregunta"}):e(y,{type:"error",title:"Oops, no encontr\xE9 ese examen",message:"Intenta con otro"})]})}})},Qe=()=>{const{id:t}=P();if(!t)return e(A,{message:"Missing assessment Id"});const{gradedAssessments:s,error:r,loading:a}=le(t);return e(F,{loading:a,error:r,children:()=>i(q,{children:[e(B,{title:"Historial"}),e(qe,{gradedAssessments:s})]})})},je=(t,s)=>{const r=t.slice();switch(s.type){case"add":return r.splice(r.length,0,{_id:"",discriminator:"option",value:"",isCorrectAnswer:!1}),r;case"remove":if(s.index===void 0)throw"Missing index";return confirm(`Est\xE1s a punto de quitar la ${s.index+1} opci\xF3n`)?(r.splice(s.index,1),r):t;case"change":if(s.index===void 0)throw"Missing index";if(!s.item)throw"Missing item";return r.map((a,n)=>n!==s.index?{...a}:{...a,...s.item})}},Z=t=>{const[s,r]=d.exports.useReducer(je,t.defaultValue||[{discriminator:"option",value:"",isCorrectAnswer:!1},{discriminator:"option",value:"",isCorrectAnswer:!1}]),a=(n,o)=>c=>{r({type:"change",index:n,item:o=="isCorrect"?{isCorrectAnswer:c.currentTarget.checked}:{value:c.currentTarget.value}})};return d.exports.useEffect(()=>{t.setValue(t.name,s)},[s]),e("div",{className:"mt-16",children:i(q,{children:[s.map((n,o)=>i("div",{className:"mb-8",children:[e("hr",{className:"mb-4"}),i(M,{spacing:4,className:"mb-4",children:[i("h4",{className:"grow w-6 text-2xl font-bold",children:["Opci\xF3n ",o+1,":"]}),e(k,{onClick:()=>r({type:"remove",index:o}),children:e(K,{})})]}),i(M,{spacing:4,grow:!0,children:[i("div",{className:"grow",children:[e("label",{htmlFor:`${o}-value`,className:"mb-2 block",children:"Respuesta"}),e("input",{id:`${o}-value`,type:"text",onChange:a(o,"value"),value:n.value,className:"grow w-full",autoComplete:"none"})]}),i("div",{className:"grid grid-cols-1 gap-4",children:[e("label",{htmlFor:`${o}-isCorrect`,className:"block",children:"Es Correcta"}),e("input",{id:`${o}-isCorrect`,type:"checkbox",onChange:a(o,"isCorrect"),defaultChecked:n.isCorrectAnswer})]})]})]},o)),e(k,{onClick:()=>r({type:"add"}),className:"!mx-auto !block",children:e(G,{})})]})})},He=()=>{const{register:t,handleSubmit:s,setValue:r,watch:a}=Q(),{id:n}=P();if(!n)return e(A,{message:"Missing assessment id"});const[o,c]=d.exports.useState(),l=_();d.exports.useState("MULTIPLE_CHOICE");const[u,m]=d.exports.useState(!1),g=a("imageBlob"),N=h=>{if(c({type:"info",content:"La pregunta se agreg\xF3 correctamente"}),g){const I=h.questions.pop();ue(g[0],n,I._id)}m(!0),setTimeout(()=>l("../"),2e3)},C=h=>{c({type:"error",content:h})},{mutate:w,error:x,isLoading:L,reset:p}=ce({assessmentId:n,onSuccess:N,onError:C}),E=h=>h.options.length>=2&&h.options.some(I=>I.isCorrectAnswer);return i("form",{onSubmit:s(h=>{if(c(void 0),p(),!E(h))return C("La pregunta no es v\xE1lida");delete h.imageBlob,w(h)}),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[e(B,{back:!0,title:"Nueva Pregunta"}),!u&&i("div",{className:"flex flex-col gap-4",children:[e(S,{type:"text",register:t,name:"title",label:"Pregunta",required:!0}),e(j,{name:"imageUrl",register:t,setValue:r,blob:g,label:"Imagen",defaultValue:""}),e("input",{type:"hidden",value:"MULTIPLE_CHOICE",...t("type",{required:!0})}),i("div",{className:"flex flex-col gap-1",children:[e("input",{type:"hidden",...t("options"),required:!0}),e(Z,{setValue:r,name:"options"})]})]}),!!x&&e(y,{type:"error",title:"Error",message:x.toString()}),o!==void 0&&!x&&e(y,{type:o.type,message:o.content.toString(),title:o.type=="error"?"Error":"\xC9xito"}),L?e(O,{}):!u&&e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})};function ze(t){const{register:s,handleSubmit:r,setValue:a,formState:n,getValues:o,watch:c}=Q({defaultValues:{...t.assessment,imageBlob:void 0}}),[l,u]=d.exports.useState(),[m,g]=d.exports.useState(!1),N=_(),C=c("imageBlob"),w=f=>{u({type:"info",content:`Cambios en "${f.title}" se guardaron correctamente`}),g(!0),setTimeout(()=>N("../"),2e3)},x=f=>{u({type:"error",content:f})},{mutate:L,error:p,isLoading:E}=de(w,x),{mutate:R,error:h,isLoading:I}=W(()=>N("../../")),V=()=>{!confirm(`Est\xE1s a punto de borrar ${t.assessment.title}, esto no se puede deshacer.
        \xBFQuieres continuar?`)||(R(t.assessment.id),g(!0),u({type:"info",content:`${t.assessment.title} se borr\xF3 correctamente`}))},$=async f=>{!f.title||!confirm(`\xBFModificar ${f.title}?`)||(f.imageBlob.length>0&&f.imageBlob[0].size>0&&(f=await J(f.imageBlob[0],t.assessment.id),delete f.imageBlob),L({...t.assessment,...f}))};return i("form",{onSubmit:r(f=>$(f)),className:"text-left flex flex-col items-stretch gap-6 relative",children:[!m&&i("div",{className:"flex flex-col gap-4",children:[e(T,{to:"../",children:e(X,{})}),e(S,{type:"text",register:s,name:"title",label:"Nombre",required:!0}),e(S,{type:"textarea",register:s,name:"description",label:"Descripci\xF3n"}),e(j,{name:"thumbnailUrl",register:s,setValue:a,blob:C,label:"Imagen",defaultValue:t.assessment.thumbnailUrl||"/MRP.WebApp/placeholder.png"}),i(M,{className:"gap-16 mx-auto",children:[e(S,{type:"checkbox",register:s,name:"isPrivate",label:"Examen Privado"}),e(S,{type:"checkbox",register:s,name:"isPremium",label:"Examen Premium"})]}),e(Y,{register:s,name:"categories",label:"Categor\xEDas",setValue:a,defaultValue:o().categories})]}),!!p&&e(y,{type:"error",title:"Error",message:p.toString()}),!!h&&e(y,{type:"error",title:"Error",message:h.toString()}),l!==void 0&&e(y,{type:l.type,message:l.content,title:l.type=="error"?"Error":"\xC9xito"}),E||I?e(O,{}):!m&&i(M,{spacing:4,items:"stretch",justify:"center",children:[e("div",{className:"bg-error-50 rounded-md text-white px-8 py-2 hover:bg-error-60 cursor-pointer",onClick:V,children:"Borrar"}),e("input",{type:"submit",value:"Guardar",disabled:!n.isValid&&!m,className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40"})]})]})}const De=()=>{const{id:t}=P();if(!t)return e(A,{message:"No ID Found in route"});const{assessment:s,error:r,loading:a}=U(t);return e(F,{loading:a,error:r,children:()=>e(ze,{assessment:s})})},Ge=De,We=t=>{const[s,r]=d.exports.useState(),a=_(),[n,o]=d.exports.useState("MULTIPLE_CHOICE"),[c,l]=d.exports.useState(!1),u=v=>{r({type:"error",content:v})},m=()=>{r({type:"info",content:"La pregunta se actualiz\xF3 correctamente"}),l(!0),setTimeout(()=>a("../"),2e3)},{mutate:g,isLoading:N}=me(t.assessmentId,t.question._id,m,u),C=()=>{var v;if($!==void 0&&((v=$[0])==null?void 0:v.size)>0)return g($[0]);m()},{mutate:w,error:x,isLoading:L,reset:p}=ge({assessmentId:t.assessmentId,questionId:t.question._id,onSuccess:C,onError:u}),{register:E,handleSubmit:R,setValue:h,watch:I,getValues:V}=Q({defaultValues:{...t.question,imageBlob:void 0}}),$=I("imageBlob"),f=v=>v.options.length>=2&&v.options.some(ee=>ee.isCorrectAnswer);return i("form",{onSubmit:R(v=>(r(void 0),p(),f(v)?(delete v.imageBlob,w(v)):u("La pregunta no es v\xE1lida"))),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[e(B,{back:!0,title:"Editar Pregunta"}),!c&&i("div",{className:"flex flex-col gap-4",children:[e(S,{type:"text",register:E,name:"title",label:"Pregunta",required:!0}),e(j,{name:"imageUrl",register:E,setValue:h,blob:$,label:"Imagen",defaultValue:t.question.imageUrl}),i("div",{className:"flex flex-col gap-1",children:[e("input",{type:"hidden",value:"MULTIPLE_CHOICE",...E("type",{required:!0})}),e("input",{type:"hidden",...E("options",{required:!0}),value:V().options&&V().options.toString()||""}),n==="MULTIPLE_CHOICE"?e(Z,{setValue:h,name:"options",defaultValue:V().options}):e(q,{})]})]}),!!x&&e(y,{type:"error",title:"Error",message:x.toString()}),s!==void 0&&!x&&e(y,{type:s.type,message:s.content.toString(),title:s.type=="error"?"Error":"\xC9xito"}),L||N?e(O,{}):!c&&e("input",{type:"submit",value:"Actualizar",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},Ke=()=>{const{id:t,questionId:s}=P();if(!t)return e(A,{message:"Missing assessment id"});if(!s)return e(A,{message:"Missing question id"});const{question:r,error:a,loading:n}=pe({assessmentId:t,questionId:s});return e(F,{loading:n,error:a,children:()=>e(We,{question:r,assessmentId:t})})},Je=Ke,it=()=>i(ve,{children:[e(b,{index:!0,element:e(Le,{})}),e(b,{path:"new",element:e(Re,{})}),i(b,{path:":id",element:e(Me,{}),children:[e(b,{index:!0,element:e(ye,{to:"details",replace:!0})}),e(b,{path:"details",element:e(Ue,{})}),i(b,{path:"questions",children:[e(b,{path:"",element:e(Oe,{})}),e(b,{path:"new",element:e(He,{})}),e(b,{path:":questionId",element:e(Je,{})})]}),e(b,{path:"history",element:e(Qe,{})}),e(b,{path:"edit",element:e(Ge,{})})]}),e(b,{path:"*",element:e(Ne,{})})]});export{it as default};
