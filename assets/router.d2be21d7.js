import{E as I,u as R,a as W,H as B,T as L,I as _,M as D,b as te,d as K,r as se,i as re,c as ae,C as ie,e as ne,f as J,g as X,h as oe,A as le,j as ce,k as ue,l as de,m as me,n as ge,o as he,p as pe}from"./appRouter.268fca7c.js";import{d as fe,a as xe,Q as be}from"./questionCard.cbdfa192.js";import{a1 as P,j as e,a as V,b as a,F as q,N as k,O as ve,r as d,Q as U,R as ye,c as b,a2 as Ne}from"./index.19305bef.js";import{R as F,N as Ce}from"./404.6162531c.js";import{d as Ee,a as we,N as j,b as Se,M as Ae,A as Ie,u as Q,I as A}from"./index.esm.15188aa0.js";import{G as qe}from"./gradedAssessmentsList.05f89877.js";import"./grade.242f0d6d.js";const Me=()=>{const{id:t}=P();if(!t)return e(I,{message:"Missing assessment Id"});const s=V(),{assessment:r,error:i,loading:n}=R(t),{mutate:o}=W(()=>s("/assessments"));return e(B,{loading:n,error:i,children:()=>a(q,{children:[a("div",{className:"sticky top-0 pt-12 px-7",children:[a("div",{className:"flex flex-row gap-4",children:[r.isPrivate&&a("div",{className:"mb-2",children:[e(Ee,{className:"mb-1"})," Privado"]}),r.isPremium&&a("div",{className:"text-amber-400 mb-2",children:[e(we,{className:"mb-1"})," Premium"]})]}),e("div",{className:"absolute -z-10 w-full h-full top-0 left-0 opacity-20 bg-cover bg-center",style:{backgroundImage:`url("${(r==null?void 0:r.thumbnailUrl)||"/MRP.WebApp/placeholder.png"}")`}}),e(L,{title:r.title,back:!0,cta:a(q,{children:[e(k,{to:"./edit",className:"hover:text-orange hover:scale-110 transition-all",children:e(fe,{})}),e(_,{onClick:()=>{!confirm(`Est\xE1s a punto de borrar ${r==null?void 0:r.title}, \xBFquieres continuar?`)||o(t)},className:"hover:!text-error-50 hover:scale-110 transition-all",children:e(xe,{})})]})})]}),a(D,{children:[a(F,{spacing:4,className:"mb-8",items:"center",children:[e(j,{to:"details",label:"Detalles"}),e(j,{to:"questions",label:"Preguntas"}),e(j,{to:"history",label:"Historial"})]}),e(ve,{})]})]})})},Fe=t=>{const[s,r]=d.exports.useState([]),i=()=>{if(!t.assessments)return r([]);const n=[];for(var o=0;o<t.assessments.length;o++){const l=t.assessments[o];for(var c=0;c<l.categories.length;c++){const u=l.categories[c];n.includes(u)||n.push(u)}}r(n)};return d.exports.useMemo(()=>{i()},[t.assessments]),a("div",{className:"max-w-xs rounded-md",children:[e("h2",{className:"mb-2",children:"Filtros"}),a("div",{className:"flex flex-row gap-4 items-center relative my-4",children:[e("h3",{className:"mt-4 hidden","aria-hidden":!0,children:"Buscar"}),e("input",{type:"text",id:"query",placeholder:"Buscar",autoComplete:"off","aria-label":"Buscar",className:"outline outline-neutral-70 w-full mt-2 placeholder:text-neutral-50 pl-10",onChange:n=>t.dispatch({property:"query",value:n.currentTarget.value})}),e(Se,{className:"absolute left-2 mt-1 top-1/2 -translate-y-1/2"})]}),e("h3",{className:"mt-4",children:"Categor\xEDas"}),e(Ae,{allOptions:s,selectedOptions:t.state.categories,onChange:n=>t.dispatch({property:"categories",value:n})})]})},Be=(t,s)=>{switch(s.property){case"categories":return t.categories.includes(s.value)?{...t,categories:t.categories.filter(r=>r!=s.value)}:{...t,categories:[s.value,...t.categories]};case"query":return{...t,query:s.value};default:return console.error("Unkown action property"),{...t}}},Le=()=>{const{assessments:t,loading:s,error:r}=te(),[i,n]=d.exports.useReducer(Be,{categories:[],query:""}),o=d.exports.useMemo(()=>{if(!t)return[];const c=i.query!="",l=i.categories.length>0,u=new RegExp(i.query,"ig");return t.filter(m=>(!l||m.categories.some(g=>i.categories.includes(g)))&&(!c||[m.title,m.categories.join(" "),m.description].some(g=>g!==void 0&&u.test(g))))},[t,i.categories,i.query]);return a(D,{sidebar:e(Fe,{assessments:t,state:i,dispatch:n}),children:[e(L,{cta:e(k,{to:"new",className:"block bg-blue px-4 py-2 rounded-md text-white hover:bg-primary-40",children:"Crear nuevo Examen"}),title:"Ex\xE1menes"}),e(B,{loading:s,error:r,children:()=>e(Ie,{assessments:o})})]})},H=t=>{const{name:s,register:r,blob:i,setValue:n,label:o}=t;let[c,l]=d.exports.useState(t.defaultValue);return d.exports.useEffect(()=>{var m;if(!(i===void 0||!((m=i[0])!=null&&m.size))){var u=new FileReader;if(i[0].size>2*1e6)return alert(`La imagen es demasiado grande.
      
      Las im\xE1genes no pueden pesar m\xE1s de 8MB`),n("imageBlob",void 0);u.readAsDataURL(i[0]),u.onload=()=>{let g=u.result.toString().replace(/^data:(.*,)?/,"");g.length%4>0&&(g+="=".repeat(4-g.length%4));const y=`data:text/css;base64,${g}`;l(y)}}},[i]),a(q,{children:[!!o&&e("label",{htmlFor:s,children:o}),e("input",{type:"file",...r("imageBlob",{required:t.required}),id:s,accept:"image/*"}),!!c&&a("div",{className:"max-w-xs mx-auto w-full relative mt-4",children:[e("img",{src:c,alt:"",className:"w-full"}),e(_,{className:"!bg-red-500 !absolute !top-2 !right-2 !text-white !rounded-full !w-8 !h-8",onClick:()=>{confirm("\xBFQuieres borrar la imagen?")&&(n(t.name,"",{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),n("imageBlob",void 0,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),l(""))},children:e(K,{})})]})]})},v=t=>a("div",{className:["p-4 border border-solid rounded-md w-full shadow-lg",t.type=="error"&&"border-error-60 bg-error-50 text-white",t.type=="info"&&"border-blue bg-surface-2"].join(" "),children:[e("h2",{children:t.title!==void 0?t.title:t.type=="info"?"\xC9xito":"Error"}),e("p",{children:t.message})]});var z={},Pe=re.exports;Object.defineProperty(z,"__esModule",{value:!0});var G=z.default=void 0,Te=Pe(se()),$e=ae,_e=(0,Te.default)((0,$e.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"AddOutlined");G=z.default=_e;const Y=t=>{const s=d.exports.useRef(null),[r,i]=d.exports.useState(t.defaultValue||[]),n=t.label||t.name[0].toLocaleUpperCase()+t.name.slice(1),o=()=>{s===null||s.current===null||(i([s.current.value.trim(),...r]),s.current.value="")},c=l=>{i(r.filter(u=>u!==l.value))};return d.exports.useEffect(()=>{t.setValue(t.name+"[]",r)},[r]),a("div",{className:"flex flex-col gap-4 w-full",children:[e("input",{type:"hidden",...t.register(t.name+"[]")}),a("div",{className:"flex flex-row gap-4 w-full items-end",children:[a("div",{className:"flex flex-col gap-1 grow",children:[a("label",{htmlFor:"multiselect",children:[n,":"]}),e("textarea",{onKeyUp:l=>{l.key=="Enter"&&(l.preventDefault(),o())},onSubmit:l=>{l.preventDefault(),o()},rows:1,className:"resize-none",placeholder:n,id:"multiselect",ref:s})]}),e(_,{"aria-label":"add",onClick:o,children:e(G,{color:"primary"})})]}),e(F,{spacing:4,wrap:!0,children:r.map(l=>e(ie,{color:"primary",label:l,onDelete:()=>c({value:l})},l))})]})},Ve=()=>{const{register:t,handleSubmit:s,setValue:r,watch:i}=Q(),[n,o]=d.exports.useState(),[c,l]=d.exports.useState(!1),u=V(),m=i("imageBlob"),g=p=>{o({type:"error",content:p})},y=p=>{o({type:"info",content:`"${p.title}" se cre\xF3 exitosamente`}),m&&J(m[0],`${p._id||p.id||""}`),l(!0),setTimeout(()=>u("../"),2e3)},{mutate:E,error:w,isLoading:N}=ne(y,g);return a("form",{onSubmit:s(p=>{!confirm(`\xBFCrear ${p.title}?`)||(delete p.imageBlob,E(p))}),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[!!w&&e(v,{type:"error",title:"Error",message:w.toString()}),n!==void 0&&e(v,{type:n.type,message:n.content,title:n.type=="error"?"Error":"\xC9xito"}),!c&&a("div",{className:"flex flex-col gap-4",children:[e(A,{type:"text",register:t,name:"title",label:"Nombre",required:!0}),e(A,{type:"textarea",register:t,name:"description",label:"Descripci\xF3n"}),e(H,{name:"thumbnailUrl",register:t,setValue:r,blob:m,label:"Imagen",defaultValue:""}),e(Y,{register:t,name:"categories",setValue:r,label:"Categor\xEDas"})]}),N?e(U,{}):!c&&e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},ke=()=>a(D,{children:[a(F,{spacing:2,items:"center",wrap:!1,children:[e(k,{to:"../",className:"mb-8",children:e(X,{})}),e("h1",{className:"mb-8 grow",children:"Nuevo Examen"})]}),e(Ve,{})]}),Oe=()=>{const{id:t}=P();if(!t)return e(I,{message:"Missing assessment Id"});const{assessment:s,error:r,loading:i}=R(t);return e(B,{loading:i,error:r,children:()=>a(q,{children:[e(L,{title:"Detalles"}),e("h2",{children:"Categor\xEDas"}),s.categories!==void 0&&e(oe,{elements:s.categories}),e("hr",{className:"my-4"}),e("h2",{className:"mb-2",children:"Descripci\xF3n"}),e("p",{className:"mb-8",children:s.description!==void 0?s.description:"Sin descripci\xF3n"}),e("hr",{className:"my-4"}),e("h2",{className:"mb-4",children:"Vista Previa"}),e("div",{className:"p-8 rounded-md bg-surface-2",children:e(le,{...s,id:t})})]})})},Re=()=>{const{id:t}=P();if(!t)return e(I,{message:"Missing assessment Id"});const{assessment:s,error:r,loading:i}=R(t);return e(B,{loading:i,error:r,children:()=>{var n;return a("div",{className:"flex flex-col gap-8",children:[e(L,{title:"Preguntas",cta:e(k,{to:"new",className:"bg-blue px-4 py-2 rounded-md text-white",children:"Agregar Pregunta"})}),s!==void 0?!!s.questions&&((n=s.questions)==null?void 0:n.length)>0?s.questions.map((o,c)=>e(be,{question:o,assessmentId:s._id||s.id},c)):e(v,{type:"info",title:"Oops, no hay preguntas",message:"Agrega una pregunta"}):e(v,{type:"error",title:"Oops, no encontr\xE9 ese examen",message:"Intenta con otro"})]})}})},Ue=()=>{const{id:t}=P();if(!t)return e(I,{message:"Missing assessment Id"});const{gradedAssessments:s,error:r,loading:i}=ce(t);return e(B,{loading:i,error:r,children:()=>a(q,{children:[e(L,{title:"Historial"}),e("h2",{children:"Categor\xEDas"}),e(qe,{gradedAssessments:s})]})})},Qe=(t,s)=>{const r=t.slice();switch(s.type){case"add":return r.splice(r.length,0,{_id:"",discriminator:"option",value:"",isCorrectAnswer:!1}),r;case"remove":if(s.index===void 0)throw"Missing index";return confirm(`Est\xE1s a punto de quitar la ${s.index+1} opci\xF3n`)?(r.splice(s.index,1),r):t;case"change":if(s.index===void 0)throw"Missing index";if(!s.item)throw"Missing item";return r.map((i,n)=>n!==s.index?{...i}:{...i,...s.item})}},Z=t=>{const[s,r]=d.exports.useReducer(Qe,t.defaultValue||[{discriminator:"option",value:"",isCorrectAnswer:!1},{discriminator:"option",value:"",isCorrectAnswer:!1}]),i=(n,o)=>c=>{r({type:"change",index:n,item:o=="isCorrect"?{isCorrectAnswer:c.currentTarget.checked}:{value:c.currentTarget.value}})};return d.exports.useEffect(()=>{t.setValue(t.name,s)},[s]),e("div",{className:"mt-16",children:a(q,{children:[s.map((n,o)=>a("div",{className:"mb-8",children:[e("hr",{className:"mb-4"}),a(F,{spacing:4,className:"mb-4",children:[a("h4",{className:"grow w-6 text-2xl font-bold",children:["Opci\xF3n ",o+1,":"]}),e(_,{onClick:()=>r({type:"remove",index:o}),children:e(K,{})})]}),a(F,{spacing:4,grow:!0,children:[a("div",{className:"grow",children:[e("label",{htmlFor:`${o}-value`,className:"mb-2 block",children:"Respuesta"}),e("input",{id:`${o}-value`,type:"text",onChange:i(o,"value"),value:n.value,className:"grow w-full",autoComplete:"none"})]}),a("div",{children:[e("label",{htmlFor:`${o}-isCorrect`,className:"block",children:"Es Correcta"}),e("input",{id:`${o}-isCorrect`,type:"checkbox",onChange:i(o,"isCorrect"),defaultChecked:n.isCorrectAnswer})]})]})]},o)),e(_,{onClick:()=>r({type:"add"}),className:"!mx-auto !block",children:e(G,{})})]})})},He=()=>{const{register:t,handleSubmit:s,setValue:r,watch:i}=Q(),{id:n}=P();if(!n)return e(I,{message:"Missing assessment id"});const[o,c]=d.exports.useState(),l=V(),[u,m]=d.exports.useState("MULTIPLE_CHOICE"),[g,y]=d.exports.useState(!1),E=i("imageBlob"),w=h=>{if(c({type:"info",content:"La pregunta se agreg\xF3 correctamente"}),E){const C=h.questions.pop();de(E[0],n,C._id)}y(!0),setTimeout(()=>l("../"),2e3)},N=h=>{c({type:"error",content:h})},{mutate:T,error:p,isLoading:S,reset:$}=ue({assessmentId:n,onSuccess:w,onError:N}),M=h=>h.options.length>=2&&h.options.some(C=>C.isCorrectAnswer);return a("form",{onSubmit:s(h=>{if(c(void 0),$(),!M(h))return N("La pregunta no es v\xE1lida");delete h.imageBlob,T(h)}),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[e(L,{back:!0,title:"Nueva Pregunta"}),!g&&a("div",{className:"flex flex-col gap-4",children:[e(A,{type:"text",register:t,name:"title",label:"Pregunta",required:!0}),e(H,{name:"imageUrl",register:t,setValue:r,blob:E,label:"Imagen",defaultValue:""}),a("div",{className:"flex flex-col gap-1",children:[e("label",{htmlFor:"type",children:"Tipo:"}),a("select",{...t("type"),onChange:h=>m(h.currentTarget.value),required:!0,children:[e("option",{value:"MULTIPLE_CHOICE",children:"Opci\xF3n M\xFAltiple"}),e("option",{value:"BOOLEAN",children:"S\xED o No"})]}),e("input",{type:"hidden",...t("options"),required:!0}),u==="MULTIPLE_CHOICE"?e(Z,{setValue:r,name:"options"}):e(q,{})]})]}),!!p&&e(v,{type:"error",title:"Error",message:p.toString()}),o!==void 0&&!p&&e(v,{type:o.type,message:o.content.toString(),title:o.type=="error"?"Error":"\xC9xito"}),S?e(U,{}):!g&&e("input",{type:"submit",value:"Crear",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})};function je(t){const{register:s,handleSubmit:r,setValue:i,formState:n,getValues:o,watch:c}=Q({defaultValues:{...t.assessment,imageBlob:void 0}}),[l,u]=d.exports.useState(),[m,g]=d.exports.useState(!1),y=V(),E=c("imageBlob"),w=f=>{u({type:"info",content:`Cambios en "${f.title}" se guardaron correctamente`}),g(!0),setTimeout(()=>y("../"),2e3)},N=f=>{u({type:"error",content:f})},{mutate:T,error:p,isLoading:S}=me(w,N),{mutate:$,error:M,isLoading:O}=W(()=>y("../../")),h=()=>{!confirm(`Est\xE1s a punto de borrar ${t.assessment.title}, esto no se puede deshacer.
        \xBFQuieres continuar?`)||($(t.assessment._id||t.assessment.id),g(!0),u({type:"info",content:`${t.assessment.title} se borr\xF3 correctamente`}))},C=async f=>{!f.title||!confirm(`\xBFModificar ${f.title}?`)||(f.imageBlob.length>0&&f.imageBlob[0].size>0&&(f=await J(f.imageBlob[0],`${t.assessment._id||t.assessment.id||""}`),delete f.imageBlob),T({...t.assessment,...f}))};return a("form",{onSubmit:r(f=>C(f)),className:"text-left flex flex-col items-stretch gap-6 relative",children:[!m&&a("div",{className:"flex flex-col gap-4",children:[e(k,{to:"../",children:e(X,{})}),e(A,{type:"text",register:s,name:"title",label:"Nombre",required:!0}),e(A,{type:"textarea",register:s,name:"description",label:"Descripci\xF3n"}),e(H,{name:"thumbnailUrl",register:s,setValue:i,blob:E,label:"Imagen",defaultValue:t.assessment.thumbnailUrl||"/MRP.WebApp/placeholder.png"}),a(F,{className:"gap-16 mx-auto",children:[e(A,{type:"checkbox",register:s,name:"isPrivate",label:"Examen Privado"}),e(A,{type:"checkbox",register:s,name:"isPremium",label:"Examen Premium"})]}),e(Y,{register:s,name:"categories",label:"Categor\xEDas",setValue:i,defaultValue:o().categories})]}),!!p&&e(v,{type:"error",title:"Error",message:p.toString()}),!!M&&e(v,{type:"error",title:"Error",message:M.toString()}),l!==void 0&&e(v,{type:l.type,message:l.content,title:l.type=="error"?"Error":"\xC9xito"}),S||O?e(U,{}):!m&&a(F,{spacing:4,items:"stretch",justify:"center",children:[e("div",{className:"bg-error-50 rounded-md text-white px-8 py-2 hover:bg-error-60 cursor-pointer",onClick:h,children:"Borrar"}),e("input",{type:"submit",value:"Guardar",disabled:!n.isValid&&!m,className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40"})]})]})}const De=()=>{const{id:t}=P();if(!t)return e(I,{message:"No ID Found in route"});const{assessment:s,error:r,loading:i}=R(t);return e(B,{loading:i,error:r,children:()=>e(je,{assessment:s})})},ze=De,Ge=t=>{const[s,r]=d.exports.useState(),i=V(),[n,o]=d.exports.useState("MULTIPLE_CHOICE"),[c,l]=d.exports.useState(!1),u=x=>{r({type:"error",content:x})},m=()=>{r({type:"info",content:"La pregunta se actualiz\xF3 correctamente"}),l(!0),setTimeout(()=>i("../"),2e3)},{mutate:g,isLoading:y}=ge(t.assessmentId,t.question._id,m,u),E=()=>{var x;if(C!==void 0&&((x=C[0])==null?void 0:x.size)>0)return g(C[0]);m()},{mutate:w,error:N,isLoading:T,reset:p}=he({assessmentId:t.assessmentId,questionId:t.question._id,onSuccess:E,onError:u}),{register:S,handleSubmit:$,setValue:M,watch:O,getValues:h}=Q({defaultValues:{...t.question,imageBlob:void 0}}),C=O("imageBlob"),f=x=>x.options.length>=2&&x.options.some(ee=>ee.isCorrectAnswer);return a("form",{onSubmit:$(x=>(r(void 0),p(),f(x)?(delete x.imageBlob,w(x)):u("La pregunta no es v\xE1lida"))),className:"text-left flex flex-col items-stretch gap-6 mb-16 relative",children:[e(L,{back:!0,title:"Editar Pregunta"}),!c&&a("div",{className:"flex flex-col gap-4",children:[e(A,{type:"text",register:S,name:"title",label:"Pregunta",required:!0}),e(H,{name:"imageUrl",register:S,setValue:M,blob:C,label:"Imagen",defaultValue:t.question.imageUrl}),a("div",{className:"flex flex-col gap-1",children:[e("label",{htmlFor:"type",children:"Tipo:"}),a("select",{...S("type",{required:!0}),onChange:x=>o(x.currentTarget.value),value:h().type,children:[e("option",{value:"MULTIPLE_CHOICE",children:"Opci\xF3n M\xFAltiple"}),e("option",{value:"BOOLEAN",children:"S\xED o No"})]}),e("input",{type:"hidden",...S("options",{required:!0}),value:h().options&&h().options.toString()||""}),n==="MULTIPLE_CHOICE"?e(Z,{setValue:M,name:"options",defaultValue:h().options}):e(q,{})]})]}),!!N&&e(v,{type:"error",title:"Error",message:N.toString()}),s!==void 0&&!N&&e(v,{type:s.type,message:s.content.toString(),title:s.type=="error"?"Error":"\xC9xito"}),T||y?e(U,{}):!c&&e("input",{type:"submit",value:"Actualizar",className:"px-8 py-2 bg-blue rounded-md text-white cursor-pointer hover:bg-primary-40 mx-auto"})]})},We=()=>{const{id:t,questionId:s}=P();if(!t)return e(I,{message:"Missing assessment id"});if(!s)return e(I,{message:"Missing question id"});const{question:r,error:i,loading:n}=pe({assessmentId:t,questionId:s});return e(B,{loading:n,error:i,children:()=>e(Ge,{question:r,assessmentId:t})})},Ke=We,at=()=>a(ye,{children:[e(b,{index:!0,element:e(Le,{})}),e(b,{path:"new",element:e(ke,{})}),a(b,{path:":id",element:e(Me,{}),children:[e(b,{index:!0,element:e(Ne,{to:"details",replace:!0})}),e(b,{path:"details",element:e(Oe,{})}),a(b,{path:"questions",children:[e(b,{path:"",element:e(Re,{})}),e(b,{path:"new",element:e(He,{})}),e(b,{path:":questionId",element:e(Ke,{})})]}),e(b,{path:"history",element:e(Ue,{})}),e(b,{path:"edit",element:e(ze,{})})]}),e(b,{path:"*",element:e(Ce,{})})]});export{at as default};
